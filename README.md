# Teensy 3.2 MIDI Controller / Macropad
A custom MIDI Controller / Macropad based on the [Teensy 3.2 microcontroller](https://www.pjrc.com/store/teensy32.html) for [MIDI2LR](https://github.com/rsjaffe/MIDI2LR/) integration and multi-keystroke macro execution.

### Inspiration for this project

Firstly, I was facing issues with editing a large number of images in Adobe Lightroom as it often takes a long time and it was not very intuitive to edit with my laptop's touchpad. Therefore, I stumbled upon MIDI2LR which uses MIDI Controllers normally used for music production to act as a physical device to change values in Lightroom.

Secondly, I wanted to create a macropad to perform tasks that would normally require multiple keypresses on the keyboard, such as while coding, CAD-ing etc., with a single press of a key.


Therefore, this controller serves 2 main purposes:
1. To send USB MIDI CC / NOTE messages in order to interface with MIDI2LR.
  
2. To send USB keyboard presses in order to chain multiple keypresses into a single macro key.

### Build Process
1. Mechanical & Electrical Fabrication
   
    I first purchased [this aluminium enclosure](https://item.taobao.com/item.htm?id=542717489532&_u=t2dmg8j26111) from Taobao, an online Chinese retailer, and milled out the holes for the encoders and the key switches to pass through. I designed a grid for the key switches in SolidWorks and fabricated it with a water jet machine out of 2mm Aluminium (which should have been 1.5mm Alu in hindsight). I then sand blasted the aluminium components and spray painted them black for aesthetic purposes.

   In order to cater for multiple functions on a single board, I added a SPDT Toggle Switch to connect to 2 digital pins on the Teensy to act as a Layer control mechanism to increase or decrease the current layer.

   As the Teensy has limited I/O slots and I wanted a large number of mechanical keyboard switches on my device to cater to the size of the enclosure I purchased, I wired up the Gateron Brown keyboard switches as well as the Encoder pushbuttons in a 4 x 7 matrix, with the help of the [Cherry MX breakout board](https://learn.sparkfun.com/tutorials/cherry-mx-switch-breakout-hookup-guide), similar to that of a regular keyboard matrix.

   Lastly, I wired all the components up to my Teensy 3.2, including 8 Incremental Rotary Encoders ([PEC11R-4215K-S0024](http://sg.element14.com/webapp/wcs/stores/servlet/ProductDisplay?catalogId=10001&langId=65&urlRequestType=Base&partNumber=2663524&storeId=10191)), 1 Potentiometer, 1 WS2812B LED strip, 1 SPDT toggle switch, my 4 x 7 switch matrix and 1 lonely Encoder pushbutton that could not fit on my switch matrix.
   
2. Code
   
3. For sending USB MIDI messages
   
   To control multiple values in Lightroom such as Exposure, Contrast, Temperature etc, I used MIDI2LR to map MIDI CC messages that were generated by the rotation of the Rotary Encoders to those corresponding Lightroom functions.
  
4. For sending multiple keyboard presses
   - test